<!-- Section  -->
<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-scale-multiple" [fullScreen]="true">
  <p style="color: white ;font-size: 20px;"> {{'page-form.loading'|translate}} </p>
</ngx-spinner>

<section class="inner-page-wrapper inner-page-wrapper-units">

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-body">
            <form [formGroup]="NotificationForm" id="NotManagementFormSubmit" class="tabs-form">
              <div class="main-unit">
                <div class="wrapper-title">
                  <h3>{{'notification.notification-manager'|translate}}</h3>
                  <hr>
                  <div (click)="onSelectMessageInformation()" *ngIf="activeTabId==1" class="form">
                    <div class="row">
                      <div class="col gap-2 grid grid-cols-3 ">
                        <div class=" ">
                          <label for="eventId" class="label-name">{{'notification.event'|translate}}<span
                              class="text-danger">*</span></label>
                          <div class="input-group  popup">
                            <ng-select formControlName="eventId" (click)="onChange()" style="width:100%">
                              <ng-option *ngFor="let event of notificationsEvents" [value]="event.id">
                                {{event.name}}
                              </ng-option>
                            </ng-select>
                            <div *ngIf="(f['eventId'].touched || f['eventId'].dirty ) && f['eventId'].invalid"
                              class="alert alert-danger">
                              <i class="fa fa-close "></i>
                              <span *ngIf="f['eventId'].errors && f['eventId'].errors['required']">
                                {{'validation-messages.required-field'|translate}}</span>
                            </div>
                          </div>
                        </div>
                        <div class=" " *ngIf="NotificationForm.value.eventId!=1">
                          <label for="period" class="label-name">{{ 'notification.period'
                            |translate}}</label>

                          <div class="form-group input-group">
                            <input type="text" class="form-control" name="period" formControlName="period">
                            <div *ngIf="(f['period'].touched || f['period'].dirty ) && f['period'].invalid"
                              class="alert alert-danger">
                              <i class="fa fa-close "></i>
                              <span *ngIf="f['period'].errors && f['period'].errors['required']">
                                {{'validation-messages.required-field'|translate}}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <hr>
                    <div class="row">
                      <div class="col gap-2 grid grid-cols-3">
                        <div class="form-group d-flex align-items-center gap-1">
                          <input type="radio" (change)="onSelectReceiver(NotificationForm.value.receiverCheckId)"
                            name="receiverCheckId" id="ownerRadioId" [value]="1" formControlName="receiverCheckId">
                          <label for="ownerRadioId" class="label-name m-0">{{
                            'notification.ownersList'
                            | translate}} </label>
                        </div>
                        <div class="form-group  d-flex align-items-center gap-1">
                          <input type="radio" id="tenantRadioId"
                            (change)="onSelectReceiver(NotificationForm.value.receiverCheckId)" name="receiverCheckId"
                            [value]="2" formControlName="receiverCheckId">
                          <label for="tenantRadioId" class="label-name m-0">{{
                            'notification.tenantsList'| translate}}</label>
                        </div>
                        <div class="form-group d-flex align-items-center gap-1">
                          <input type="radio" id="realestateTenantId"
                            (change)="onSelectReceiver(NotificationForm.value.receiverCheckId)" name="receiverCheckId"
                            [value]="3" formControlName="receiverCheckId">
                          <label for="realestateTenantId" class="label-name m-0">{{
                            'notification.buildingsTenants' | translate}} </label>
                        </div>
                      </div>
                    </div>
                    <hr>
                    <div class="row">
                      <div class="col gap-2 grid grid-cols-3">
                        <div class="form-group input-group">
                          <label for="ownersList" class="label-name">{{'notification.ownersList'|translate}}</label>
                          <p-multiSelect [options]="ownersList" [ngModelOptions]="{standalone: true}"
                            [disabled]="NotificationForm.value.receiverCheckId==2||NotificationForm.value.receiverCheckId==3"
                            [(ngModel)]="ownersListSelected" [virtualScroll]="true"
                            optionLabel="{{lang=='en'?'nameEn':'nameAr'}}" id="ownersList"
                            (ngModelChange)="ownerDataChanged($event)" name="ownersIds" class="w-100"
                            defaultLabel="{{'general.select'|translate}}">
                          </p-multiSelect>

                        </div>
                        <div class="form-group input-group">
                          <label for="ownersList" class="label-name">{{'notification.tenantsList'|translate}}</label>
                          <p-multiSelect [options]="tenantsList" [ngModelOptions]="{standalone: true}"
                            [disabled]="NotificationForm.value.receiverCheckId==1||NotificationForm.value.receiverCheckId==3"
                            [(ngModel)]="tenantsListSelected" [virtualScroll]="true"
                            optionLabel="{{lang=='en'?'nameEn':'nameAr'}}" id="tenantsList" name="tenantsIds"
                            class="w-100" defaultLabel="{{'general.select'|translate}}"></p-multiSelect>

                        </div>
                        <div class="form-group input-group">
                          <label for="buildingsList"
                            class="label-name">{{'notification.buildingsList'|translate}}</label>
                          <p-multiSelect [options]="buildingsList" [ngModelOptions]="{standalone: true}"
                            [disabled]="NotificationForm.value.receiverCheckId==1||NotificationForm.value.receiverCheckId==2"
                            [(ngModel)]="buildingsListSelected" [virtualScroll]="true"
                            optionLabel="{{lang=='en'?'buildingNameEn':'buildingNameAr'}}" id="buildingsList"
                            name="buildingsIds" class="w-100" defaultLabel="{{'general.select'|translate}}">
                          </p-multiSelect>

                        </div>
                      </div>
                    </div>
                    <hr>
                    <div class="row">
                      <div class="col gap-2 grid grid-cols-3">
                        <div class="form-group d-flex align-items-center gap-1">
                          <input type="checkbox" name="isWhatsApp" formControlName="isWhatsApp">
                          <label for="isWhatsApp" class="label-name m-0">{{'notification.isWhatsApp'|translate}}
                          </label>
                        </div>
                        <div class="form-group  d-flex align-items-center gap-1">
                          <input type="checkbox" name="isEmail" formControlName="isEmail">
                          <label for="isEmail" class="label-name m-0">{{'notification.isEmail'|translate}}
                          </label>
                          <div *ngIf="(f['isEmail'].touched || f['isEmail'].dirty ) && f['isEmail'].invalid"
                            class="validation alert-danger">
                            <i class="fa fa-close "></i>
                            <span *ngIf="f['isEmail'].errors && f['isEmail'].errors['required']">
                              {{'notification.ChooseEmail'|translate}}</span>
                          </div>
                        </div>

                        <div class="form-group d-flex align-items-center gap-1">
                          <input type="checkbox" name="isSms" formControlName="isSms">
                          <label for="isSms" class="label-name m-0">{{'notification.isSMS'|translate}}
                          </label>
                        </div>
                      </div>



                    </div>
                  </div>
                  <hr>
                  <!-- start tabs -->
                  <ul ngbNav #nav="ngbNav" [(activeId)]="activeTabId" class="nav-tabs mt-3">
                    <li [ngbNavItem]="1" [disabled]="activeTabId==2">
                      <a ngbNavLink>{{'notification.message-information'|translate}}</a>
                      <ng-template ngbNavContent>
                        <div class="row">
                          <div class="col gap-2 grid grid-cols-2 ">
                            <div class=" ">
                              <label for="subject" class="label-name">{{
                                'notification.subject' | translate}}</label>
                              <div class="form-group input-group">
                                <input type="text" class="form-control" name="subject" formControlName="subject">
                              </div>
                              <div *ngIf="(f['subject'].touched || f['subject'].dirty ) && f['subject'].invalid"
                                class="validation alert-danger">
                                <i class="fa fa-close "></i>
                                <span *ngIf="f['subject'].errors && f['subject'].errors['required']">
                                  {{'validation-messages.required-field'|translate}}</span>
                              </div>

                            </div>
                            <div class=" ">
                              <label for="sender" class="label-name">{{'notification.sender'|
                                translate}}</label>

                              <div class="form-group input-group">
                                <input type="text" class="form-control" name="sender" formControlName="sender">
                              </div>
                              <div *ngIf="(f['sender'].touched || f['sender'].dirty ) && f['sender'].invalid"
                                class="validation alert-danger">
                                <i class="fa fa-close "></i>
                                <span *ngIf="f['sender'].errors && f['sender'].errors['required']">
                                  {{'validation-messages.required-field'|translate}}</span>
                              </div>

                            </div>
                          </div>
                        </div>
                        <hr>
                        <div class="row">
                          <div class="col gap-2 grid  ">
                            <div class="col-12">
                              <p> {{'notification.smsInstrucation'|translate}}</p>
                              <ul class="list-unstyled">
                                <li>{{'notification.smsIns1'|translate}}</li>
                                <li>{{'notification.smsIns2'|translate}}</li>
                                <li>{{'notification.showContractsElement'|translate}}
                                </li>
                              </ul>
                            </div>
                            <div class=" ">
                              <button type="button" (click)="onSelectText(1)"
                                class="btn btn-primary m-1">{{'notification.ShowContractId'|translate}}</button>
                              <button type="button" (click)="onSelectText(2)"
                                class="btn btn-primary m-1">{{'notification.ShowEndContractDate'|translate}}</button>
                              <button type="button" (click)="onSelectText(3)"
                                class="btn btn-primary m-1">{{'notification.ShowDueEndDate'|translate}}</button>
                              <button type="button" (click)="onSelectText(4)"
                                class="btn btn-primary m-1">{{'notification.ShowOwnerName'|translate}}</button>
                              <button type="button" (click)="onSelectText(5)"
                                class="btn btn-primary m-1">{{'notification.ShowTenantName'|translate}}</button>
                              <button type="button" (click)="onSelectText(6)"
                                class="btn btn-primary m-1">{{'notification.ShowUnitName'|translate}}</button>
                              <button type="button" (click)="onSelectText(7)"
                                class="btn btn-primary m-1">{{'notification.ShowTotalContractAmount'|translate}}</button>
                              <button type="button" (click)="onSelectText(8)"
                                class="btn btn-primary m-1">{{'notification.ShowBuildingName'|translate}}</button>
                              <button type="button" (click)="onSelectText(9)"
                                class="btn btn-primary m-1">{{'notification.ShowRemainingPeriod'|translate}}</button>
                              <button type="button" (click)="onSelectText(10)"
                                class="btn btn-primary m-1">{{'notification.ShowRemainDueAmount'|translate}}</button>
                              <button type="button" (click)="onSelectText(11)"
                                class="btn btn-primary m-1">{{'notification.ShowDuePeriod'|translate}}</button>

                            </div>
                          </div>
                        </div>
                        <hr>
                        <div class="row">

                          <div class="col gap-2 grid  ">
                            <div class=" ">
                              <label for="sender" class="label-name">{{'notification.message'|
                                translate}}</label>
                              <quill-editor class="h-75" style="width:80%" formControlName="notificationBody"
                                name="notificationBody" (onContentChanged)="maxLengthmainTextText($event)" #quillEditor
                                [minLength]="10" placeholder="{{'general.insert-text-here'|translate}}"
                                [maxLength]="700">
                              </quill-editor>
                            </div>
                            <div class="col-12 mt-lg-0 mt-1 ">
                              <div class="caption mt-5 pt-5">
                                <span class="alert-success mt-1 px-2"
                                  [ngStyle]="{'color':contentError === true ? 'green' : 'red' }">
                                  {{'validation-messages.text-size-error'|translate}}
                                </span>
                                <span *ngIf="contentError === true" class=" alert-success mt-1 px-2"
                                  [ngStyle]="{'color':contentError === true ? 'green' : 'red' }">
                                  -- {{contentSize}}
                                  {{'general.character'|translate}} </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-template>
                    </li>
                    <li [ngbNavItem]="2">
                      <a ngbNavLink>{{'notification.notifications-list'| translate}} </a>
                      <ng-template ngbNavContent>
                        <table class="table  table-bordered text-center table-striped ">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>{{'notification.event'|translate}}</th>
                              <th>{{'notification.sender'|translate}}</th>
                              <th>{{'notification.receiver'|translate}}</th>
                              <th>{{'notification.type'|translate}}</th>
                              <th>{{'general.action'|translate}}</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let item of notificationList;  let i =index">
                              <td>{{ i + 1}}</td>
                              <td>
                                <ng-container *ngIf="item?.eventId == 1;">
                                  {{'notification.sendNow'|translate}}
                                </ng-container>
                                <ng-container *ngIf="item?.eventId == 2;">
                                  {{'notification.beforeDueDate'|translate}}
                                </ng-container>
                                <ng-container *ngIf="item?.eventId == 3;">
                                  {{'notification.beforeEndContract'|translate}}
                                </ng-container>
                              </td>
                              <td>
                                {{item.sender}}
                              </td>
                              <td>
                                <ng-container *ngIf="item?.receiverCheckId == 1;">
                                  {{'notification.owner'|translate}}
                                </ng-container>
                                <ng-container *ngIf="item?.receiverCheckId == 2;">
                                  {{'notification.tenant'|translate}}
                                </ng-container>
                                <ng-container *ngIf="item?.receiverCheckId == 3;">
                                  {{'notification.realestateTenant'|translate}}
                                </ng-container>
                              </td>
                              <td>
                                <ng-container *ngIf="item?.isWhatsApp == true;">
                                  {{'notification.isWhatsApp'|translate}}
                                </ng-container>
                                &nbsp;
                                <ng-container *ngIf="item?.isEmail == true;">
                                  {{'notification.isEmail'|translate}}
                                </ng-container>
                                &nbsp;
                                <ng-container *ngIf="item?.isSms == true;">
                                  {{'notification.isSMS'|translate}}
                                </ng-container>
                              </td>
                              <td class="action">
                                <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
                                  <div class="btn-group" role="group">
                                    <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle"
                                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      <i class="fas fa-cog ml-1"></i>
                                    </button>
                                    <div class="dropdown-menu text-center" aria-labelledby="btnGroupDrop1">
                                      <a href="javascript:void(0);" (click)="edit(item.id)" class="dropdown-item"><i
                                          class="fa fa-edit ml-1"></i>
                                        {{'buttons.edit'|translate}}</a>
                                      <a (click)="delete(item.id)" class="dropdown-item"><i
                                          class="fas fa-trash ml-1"></i>
                                        {{'buttons.delete'|translate}}</a>
                                    </div>
                                  </div>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>

                      </ng-template>
                    </li>
                    <li [ngbNavItem]="3">
                      <a ngbNavLink>{{'notification.notifications-logs'|translate}} </a>
                      <ng-template ngbNavContent>

                        <app-tabulator [idColName]="'id'" [childRowData]="notificatonsLogsList"
                          [parentColName]="'groupId'" [divId]="'NotificatonsLogsList'" [columnSettings]="columnNames"
                          [componentName]="'Districts'" (onAddItem)="openNotificatonsLogsList()"
                          (onMenuActionSelected)="onMenuActionSelected($event)" [showMenuOptions]="menuOptions"
                          [direction]="direction" [sortByList]="sortByCols" [groupByList]="groupByCols"
                          [panelId]="panelId" [searchFilters]="searchFilters"
                          (onSearchTextChange)="onSearchTextChange($event)" [groupType]="1"
                          [path]="'NotificatonsLogsList'"></app-tabulator>


                      </ng-template>
                    </li>
                  </ul>
                  <div [ngbNavOutlet]="nav" class=""></div>
                  <!-- end tabs -->
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Section  -->